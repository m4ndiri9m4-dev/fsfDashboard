<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>ELLE, CCMGI | Live Data Monitor</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" xintegrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!-- Google Fonts for Futuristic Look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js Library for Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Custom CSS (Merged from styles.css) -->
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #4F46E5, #EC4899); /* Indigo to Pink */
            color: white;
            min-height: 100vh;
            padding-top: 70px; /* Space for fixed navbar */
        }
        .gold-accent {
            color: #FFD700 !important; /* Gold accent color */
        }
        .futuristic-card {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            border-radius: 1rem;
            padding: 20px;
        }
        .navbar-dark {
            background-color: rgba(0, 0, 0, 0.8) !important;
            border-bottom: 2px solid #FFD700;
        }
        .navbar-brand, .nav-link {
            font-weight: 700;
        }
        .nav-link i {
            margin-right: 5px;
        }
        .custom-report h2 {
            color: #EC4899;
            font-weight: 700;
            font-size: 1.5rem;
        }
        .btn-warning {
            background-color: #FFD700;
            border-color: #FFD700;
            color: #1a202c;
            transition: all 0.3s;
        }
        .btn-warning:hover {
            background-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            transform: scale(1.05);
        }
        /* Style for the fetched table data */
        .table-dark thead th {
            background-color: #4F46E5;
            color: #FFD700;
        }
        .table-dark tbody tr:nth-child(odd) {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .table-dark tbody tr:hover {
            background-color: rgba(255, 215, 0, 0.1);
        }

        /* Home Grid Styles */
        .grid-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 30px 15px;
            height: 100%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            background-color: rgba(79, 70, 229, 0.6); /* Indigo base */
            border: 2px solid #FFD700;
            border-radius: 1rem;
        }
        .grid-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.9);
            background-color: rgba(79, 70, 229, 0.8);
        }
        /* NEW: Styles for image icons replacing Font Awesome icons */
        .grid-button .icon-img {
            width: 70px; /* Standard size for large grid icons */
            height: 70px;
            margin-bottom: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 5px;
            object-fit: contain;
        }
        .grid-button span {
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 0 5px #FFD700;
        }
        /* NEW: Styles for icons inside report buttons */
        .report-icon-img {
            height: 24px;
            width: 24px;
            margin-right: 8px;
            object-fit: contain;
        }
        /* NEW: Style for the large section header image */
        .section-header-img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }


        .chart-container {
            position: relative;
            height: 40vh; /* Set a default height for responsiveness */
            width: 100%;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 15px;
        }
        
        /* Modal Styles */
        .modal-content {
            background: linear-gradient(135deg, #1f1d47, #3d0a25);
            border: 2px solid #EC4899;
            color: white;
            font-family: 'Orbitron', sans-serif;
        }
        .modal-header {
            border-bottom: 1px solid #FFD700;
        }
        .modal-title {
            color: #FFD700;
            font-weight: 700;
        }
        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
        /* Existing Status Styles */
        .status-P { background-color: #38a169; }
        .status-A { background-color: #c53030; }
        .status-L { background-color: #4c51bf; }
        .status-D { background-color: #dd6b20; }

        /* Daily Attendance List Styling */
        .daily-status-list {
            list-style: none;
            padding: 0;
        }
        .daily-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 5px;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.05);
            border-left: 5px solid;
        }
        .status-P-border { border-left-color: #38a169; }
        .status-A-border { border-left-color: #c53030; }
        .status-L-border { border-left-color: #4c51bf; }
        .status-D-border { border-left-color: #dd6b20; }
        .status-O-border { border-left-color: #FFD700; } /* Other/Unknown */
        
        /* New P1/P2 Breakdown Style */
        .payroll-breakdown {
            display: flex;
            flex-direction: column;
            text-align: right;
            font-size: 0.85rem;
        }
        .payroll-p1 {
            color: #FFD700; /* Gold */
            font-weight: 700;
        }
        .payroll-p2 {
            color: #C0C0C0; /* Silver/Light Grey */
            font-weight: 500;
        }
        
        /* Calendar Specific Styles */
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #EC4899;
            color: white;
            padding: 10px;
            border-radius: 0.5rem 0.5rem 0 0;
            font-size: 1.25rem;
            font-weight: 700;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 0 0 0.5rem 0.5rem;
            padding: 10px;
        }
        .day-name {
            font-size: 0.85rem;
            font-weight: 700;
            padding: 5px 0;
            color: #FFD700; /* Gold accent */
        }
        .day-cell {
            padding: 10px 5px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-weight: 500;
        }
        .day-cell:hover {
            background-color: rgba(79, 70, 229, 0.8); /* Indigo hover */
        }
        .day-cell.inactive {
            color: rgba(255, 255, 255, 0.3);
            cursor: default;
        }
        .day-cell.inactive:hover {
            background-color: transparent;
        }
        .calendar-nav button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 10px;
        }
        /* Custom CSS for the logo image */
        .navbar-logo {
            height: 40px; /* Set a fixed height for the logo */
            width: auto;
            max-width: 150px; /* Ensure it doesn't get too wide on small screens */
            display: block;
        }

    </style>
</head>
<body>

    <!-- Start Navigation -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <!-- Navbar Brand: Replaced text with image -->
            <a class="navbar-brand" href="#" onclick="switchView('home')">
                <img src="elle_logo.png" alt="ELLE,CCMGI-ERP Logo" class="navbar-logo">
            </a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Start Links -->
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <!-- Home (Updated Icon to Image) -->
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="switchView('home')">
                            <img src="home.png" alt="Home Icon" class="report-icon-img"> Home
                        </a>
                    </li>
                    <!-- About -->
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="switchView('about')">
                            <i class="fas fa-info-circle gold-accent"></i> About
                        </a>
                    </li>
                    <!-- Contact -->
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="switchView('contact')">
                            <i class="fas fa-headset gold-accent"></i> Contact
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- End Navigation -->

    <!-- Main Container -->
    <div class="container mt-5">
        <div id="content-area">

            <!-- ============================================== -->
            <!-- 0. HOME INTERFACE (Dashboard Menu)             -->
            <!-- ============================================== -->
            <div id="home-view" class="view-section">
                <h1 class="text-center fw-bold mb-5 gold-accent">Project Dashboard Menu</h1>
                <div class="row g-4">
                    
                    <!-- Project FSF Button -->
                    <div class="col-12 col-lg-4">
                        <div class="grid-button" onclick="switchView('project-fsf')">
                            <i class="fas fa-chart-line gold-accent"></i>
                            <span>Project FSF - Eastern Visayas</span>
                        </div>
                    </div>

                    <!-- Project Command Button -->
                    <div class="col-12 col-lg-4">
                        <div class="grid-button" onclick="switchView('project-command')">
                            <i class="fas fa-shield-alt gold-accent"></i>
                            <span>Project Command - Northern Luzon</span>
                        </div>
                    </div>

                    <!-- Project Opella Button -->
                    <div class="col-12 col-lg-4">
                        <div class="grid-button" onclick="switchView('project-opella')">
                            <i class="fas fa-globe-asia gold-accent"></i>
                            <span>Project Opella - Nationwide</span>
                        </div>
                    </div>

                </div>
            </div>
            
            <!-- ============================================== -->
            <!-- 1. PROJECT FSF MASTER SECTION (New Hub)        -->
            <!-- ============================================== -->
            <div id="project-fsf-view" class="view-section" style="display:none;">
                <h1 class="text-center fw-bold mb-5 gold-accent">Project FSF</h1>
                
                <!-- START SECTION: MANDAYS AND ATTENDANCE MONITORING -->
                <div id="mandays-monitoring-wrapper" class="futuristic-card mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="mb-0">
                            <!-- Mandays Icon as Title -->
                            <img src="mandays.png" alt="Mandays Monitoring" class="section-header-img gold-accent me-2"> Mandays Monitoring
                        </h2>
                        <!-- Collapse Toggle Button for Sub-options -->
                        <button class="btn btn-sm btn-warning" data-bs-toggle="collapse" data-bs-target="#mandays-sub-menu" aria-expanded="false" aria-controls="mandays-sub-menu">
                            VIEW OPTIONS
                        </button>
                    </div>

                    <!-- Mandays Sub-menu Container -->
                    <div id="mandays-sub-menu" class="collapse">
                        <div class="row g-2 p-3 border border-secondary rounded-lg">
                            
                            <!-- Button: Attendance Per Seller (Total List) -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showMandaysReport('attendance_per_seller')">
                                    <i class="fas fa-user-check me-1"></i> Attendance Per Seller (Total List)
                                </button>
                            </div>
                            
                            <!-- Button: Daily Attendance Calendar -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showMandaysReport('daily_calendar')">
                                    <i class="fas fa-calendar-day me-1"></i> Daily Attendance Calendar
                                </button>
                            </div>
                            
                            <!-- Button: Total Deployment per Month (TL, Sellers) (Monthly Table) -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showMandaysReport('monthly_deployment')">
                                    <i class="fas fa-chart-bar me-1"></i> Total Deployment per Month (TL, Sellers)
                                </button>
                            </div>
                            
                            <!-- Container for report output -->
                            <div id="mandays-report-output" class="col-12 mt-3">
                                <div class="alert alert-info text-center fw-bold">
                                    <i class="fas fa-info-circle me-1"></i> Note: For Monthly Totals, first use the **Daily Attendance Calendar** button and navigate to the desired month (e.g., October 2025).
                                </div>
                                <div class="text-center p-3 text-white-50">Select a report option above.</div>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- END SECTION: MANDAYS AND ATTENDANCE MONITORING -->

                
                <!-- START SECTION: POSTPAID MONITORING (New Wrapper) -->
                <h3><img src="postpaid.png" alt="Mandays Monitoring" class="section-header-img gold-accent me-2"> Postpaid Monitoring</h3>
                <div id="postpaid-monitoring-wrapper" class="futuristic-card mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="mb-0">
                            <!-- Postpaid Icon as Title -->
                            <i class="fas fa-wifi gold-accent section-header-img"></i> Postpaid Monitoring
                        </h2>
                        <!-- Collapse Toggle Button for Sub-options -->
                        <button class="btn btn-sm btn-warning" data-bs-toggle="collapse" data-bs-target="#postpaid-sub-menu" aria-expanded="false" aria-controls="postpaid-sub-menu">
                            VIEW OPTIONS
                        </button>
                    </div>

                    <!-- Postpaid Sub-menu Container -->
                    <div id="postpaid-sub-menu" class="collapse">
                        <div class="row g-2 p-3 border border-secondary rounded-lg">
                            <!-- Target for the metrics output -->
                            <div id="postpaid-report-output" class="col-12 mb-3">
                                <div class="text-center p-3 text-white-50">Select a report option below.</div>
                            </div>

                            <!-- Total Applications Submitted -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showPostpaidReport('total_submitted')">
                                    <i class="fas fa-file-upload me-1"></i> Total Applications Submitted
                                </button>
                            </div>

                            <!-- Total Applications Approved -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showPostpaidReport('total_approved')">
                                    <i class="fas fa-check-circle me-1"></i> Total Applications Approved
                                </button>
                            </div>
                            
                            <!-- Total Applications Installed -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showPostpaidReport('total_installed')">
                                    <i class="fas fa-wrench me-1"></i> Total Applications Installed
                                </button>
                            </div>

                            <!-- Total Pending Installation -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showPostpaidReport('pending_install')">
                                    <i class="fas fa-clock me-1"></i> Total Pending Installation
                                </button>
                            </div>

                            <!-- Total Pending Approval -->
                            <div class="col-12">
                                <button class="btn btn-primary w-100 fw-bold" onclick="showPostpaidReport('pending_approval')">
                                    <i class="fas fa-hourglass-half me-1"></i> Total Pending Approval
                                </button>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- END SECTION: POSTPAID MONITORING -->

                
                <h3><img src="mandays.png" alt="Mandays Monitoring" class="section-header-img gold-accent me-2">WowFi Pro Monitoring</h3>

                <!-- WOWFI PRO BLOCKS -->
                <div id="wowfi-sold-summary" class="custom-report futuristic-card mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <!-- WowFi Pro Icon (Replaced with Font Awesome) -->
                        <h2><i class="fas fa-box-open gold-accent section-header-img"></i> Total WowFi Pro Sold</h2>
                        <button class="btn btn-sm btn-warning" data-bs-toggle="collapse" data-bs-target="#wowfi-sold-content" aria-expanded="false" aria-controls="wowfi-sold-content">
                            VIEW DATA
                        </button>
                    </div>
                    <div id="wowfi-sold-content" class="collapse mt-3">
                        <div class="text-center p-3 text-secondary">Click 'View Data' to load total sold count...</div>
                    </div>
                </div>
                
                <h3 class="text-center fw-bold mb-4 mt-5 gold-accent" style="color:#EC4899 !important;">SIM Sold Reporting</h3>

                <!-- SIM SOLD BLOCKS -->
                <div id="simsold-sold-summary" class="custom-report futuristic-card mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <!-- SIM Sold Icon (Replaced with Font Awesome) -->
                        <h2><i class="fas fa-sim-card gold-accent section-header-img"></i> Total SIM Sold</h2>
                        <button class="btn btn-sm btn-warning" data-bs-toggle="collapse" data-bs-target="#simsold-sold-content" aria-expanded="false" aria-controls="simsold-sold-content">
                            VIEW DATA
                        </button>
                    </div>
                    <div id="simsold-sold-content" class="collapse mt-3">
                        <div class="text-center p-3 text-secondary">Loading Sold Count Data...</div>
                    </div>
                </div>
            </div>
            
            <!-- ============================================== -->
            <!-- 2. PROJECT COMMAND SECTION (Placeholder)       -->
            <!-- ============================================== -->
            <div id="project-command-view" class="view-section" style="display:none;">
                <h1 class="text-center fw-bold mb-5 gold-accent">Project Command - Northern Luzon</h1>
                <div class="futuristic-card text-center p-5">
                    <p class="fs-4 text-warning">System Offline</p>
                    <p class="text-white-50">This dashboard section is awaiting data integration for Northern Luzon reports.</p>
                </div>
            </div>

            <!-- ============================================== -->
            <!-- 3. PROJECT OPELLA SECTION (Placeholder)        -->
            <!-- ============================================== -->
            <div id="project-opella-view" class="view-section" style="display:none;">
                <h1 class="text-center fw-bold mb-5 gold-accent">Project Opella - Nationwide</h1>
                <div class="futuristic-card text-center p-5">
                    <p class="fs-4 text-warning">System Offline</p>
                    <p class="text-white-50">This dashboard section is awaiting data integration for Nationwide reports.</p>
                </div>
            </div>

            <!-- ============================================== -->
            <!-- 4. ABOUT SECTION (Description and Developer Details) -->
            <!-- ============================================== -->
            <div id="about-view" class="view-section" style="display:none;">
                <h1 class="text-center fw-bold mb-5 gold-accent">About the Dashboard</h1>
                <div class="futuristic-card p-4 mb-4">
                    <h2 class="gold-accent mb-3">System Overview: FSF Dashboard</h2>
                    <p>This is a custom, mobile-first **Live Data Monitoring Tool** built specifically for the **FSF Project**. Its primary function is to provide the Project Coordinator and stakeholders with **real-time performance insights** pulled directly from linked Google Sheets.</p>
                    <p>The system features dynamic, responsive reporting for Manpower/Attendance tracking and Sales/Application monitoring for Postpaid Home WiFi, WowFi Pro, and SIM sales across various projects.</p>
                </div>
                
                <div class="futuristic-card p-4 mb-4">
                    <h2 class="gold-accent mb-3">Developer Credit & Contact</h2>
                    <h4 class="text-white mb-3">Harold Loteyro (<span class="text-warning">M4NDIRI9M4</span>)</h4>
                    
                    <p class="fs-6 text-white-50 fw-bold">
                        <i class="fas fa-laptop-code me-2 text-warning"></i> 
                        Available for **Freelance Development Services**.
                        <br>
                        Reach out if you need custom dashboards, automation, or web solutions!
                    </p>
                    <hr class="border-secondary my-3">
                    
                    <p class="mb-1"><i class="fas fa-mobile-alt me-2 text-warning"></i> <strong>Cell#:</strong> 09910120963</p>
                    <p class="mb-1"><i class="fab fa-viber me-2 text-warning"></i> <strong>Viber#:</strong> 09939580509</p>
                    <p class="mb-1"><i class="fas fa-envelope me-2 text-warning"></i> <strong>Email:</strong> m4ndiri9m4.dev@gmail.com</p>
                </div>
            </div>

            <!-- ============================================== -->
            <!-- 5. CONTACT SECTION (Placeholder)               -->
            <!-- ============================================== -->
            <div id="contact-view" class="view-section" style="display:none;">
                <h1 class="text-center fw-bold mb-5 gold-accent">Contact Support</h1>
                <div class="futuristic-card p-4">
                    <p>For support regarding data configuration or dashboard features, please contact the Project Coordinator.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- End Main Container -->

    <!-- Modal (Used for Daily Attendance) -->
    <div class="modal fade" id="attendanceModal" tabindex="-1" aria-labelledby="attendanceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="attendanceModalLabel">Daily Attendance Status</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Dynamic daily attendance list will be inserted here -->
                    <div id="attendanceDetailsBody">Loading attendance details...</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Modal -->

    <footer class="py-3 mt-auto bg-dark">
        <div class="container">
            <!-- Main IP Statement Paragraph -->
            <p class="m-0 text-center text-white-50" style="color: #FFBF00 !important; font-size: 0.8rem;">
                <!-- Used Bootstrap text-center for block-level centering of content -->
                <span style="display: block; text-align: justify; margin: 0 auto; max-width: 90%;">
                    All content, data visualizations, reports, and design elements presented on this website and in associated documents are the intellectual property of Gracelle Anne Magnaye, CCMGI Project Coordinator. These materials are protected under applicable copyright and intellectual property laws.
Unauthorized reproduction, distribution, modification, or commercial use of any part of these reports—whether in whole or in part—is strictly prohibited without prior written consent. This includes, but is not limited to, copying data structures, UI/UX layouts, dashboard components, and embedded analytics.
Use of these materials by clients and stakeholders is permitted solely for internal review and decision-making purposes. Any external sharing or publication must be explicitly approved.
                </span>
            </p>
            <!-- Separate Copyright Line, now in silver and bold -->
            <p class="m-0 text-center fw-bold" style="color: #C0C0C0 !important;">
                © 2025 Gracelle Anne Magnaye, CCMGI. All rights reserved.
            </p>
            <!-- New Developed By Line (MOVED TO BOTTOM) -->
            <!-- FIX: Added developer name here as well for visibility -->
            <p class="m-0 text-center text-white-50" style="font-size: 0.8em;">
                Developed by: Harold Loteyro (M4NDIRI9M4)
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <script>
        // Global map to hold Chart instances for dynamic destruction and recreation
        let chartInstances = {};
        
        // --- Configuration ---
        // 1. INPUT YOUR GOOGLE API KEY HERE (If not done already)
        const API_KEY = 'AIzaSyCoastovR_u1wB8gxkAOn5Esy6OU22ozVY';
        // 2. YOUR SPREADSHEET ID (Provided by user)
        const SPREADSHEET_ID = '10rPB-U5hdtdAkyfZlcmr82Fg_SnV1P8g5nwQ_D-0ABI';
        const QUERY_URL = 'https://docs.google.com/spreadsheets/d/';
        
        // 3. ATTENDANCE CONFIGURATION (Mandays sheet layout for payroll check)
        // This object defines the sheets and ranges for a given month/year key.
        const ATTENDANCE_CONFIG = {
            '9/2025': [
                { sheetRange: 'September 1 to 15, 2025!A6:R18', startDay: 1, endDay: 15, sheetName: 'September 1 to 15, 2025' },
                { sheetRange: 'September 16 to 30, 2025!A6:R27', startDay: 16, endDay: 30, sheetName: 'September 16 to 30, 2025' }
            ],
            // FIX: Correctly defining the October configuration.
            '10/2025': [
                { sheetRange: 'October 1 to 15, 2025!A6:R27', startDay: 1, endDay: 15, sheetName: 'October 1 to 15, 2077' }
                // NOTE: Add 'October 16 to 31, 2025!A6:R27' here when you have that sheet ready!
            ]
        };
        
        // 4. POSTPAID REPORT CONFIGURATION
        const POSTPAID_CONFIG = {
            'total_submitted': { range: 'summaryReports!AE16:AG16', headers: ['Total', 'Target', 'Achievement'] },
            'total_approved': { range: 'summaryReports!AE17:AG17', headers: ['Total', 'Target', 'Achievement'] },
            'total_installed': { range: 'summaryReports!AE18:AG18', headers: ['Total', 'Target', 'Achievement'] },
            'pending_install': { range: 'summaryReports!AE19:AG19', headers: ['Total', 'Target', 'Achievement'] },
            'pending_approval': { range: 'summaryReports!AE20:AG20', headers: ['Total', 'Target', 'Achievement'] },
        };


        let attendanceDataCache = {}; // Cache stores combined data per period key ('9/2025')
        let currentCalendarDate = new Date(2025, 8, 1); // Tracks the currently displayed month/year for the calendar (starts Sept 1, 2025)

        /**
         * Looks up the configuration object for a specific date within the ATTENDANCE_CONFIG.
         * @param {string} dateString - The date (e.g., "9/1/2025").
         * @returns {Object | null} The period config object if found, otherwise null.
         */
        function getDatePeriodConfig(dateString) {
            const date = new Date(dateString);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            const key = `${month}/${year}`;
            
            const periods = ATTENDANCE_CONFIG[key];
            if (!periods) return null;
            
            // Find the specific period (e.g., 1-15 or 16-30) that contains this day
            return periods.find(p => day >= p.startDay && day <= p.endDay);
        }

        /**
         * Helper to fetch and cache the data matrix from multiple sheets for a full month/period.
         * Used for monthly/seller totals.
         * @param {string} monthYearKey - The key (e.g., '9/2025') for the config object.
         * @returns {Promise<Array<Array<string>>>} The combined raw matrix data values.
         */
        async function fetchAttendanceDataForPeriod(monthYearKey) {
            if (attendanceDataCache[monthYearKey]) {
                return attendanceDataCache[monthYearKey];
            }

            const periods = ATTENDANCE_CONFIG[monthYearKey];
            if (!periods) {
                throw new Error(`Configuration Error: No attendance periods defined for ${monthYearKey}.`);
            }

            let combinedData = {
                headerRow: null,
                sellerRows: []
            };
            
            // To handle non-aligned dates across the two sheets, we merge row by row based on name.
            let sellerMap = new Map();
            let uniqueDates = [];

            for (const period of periods) {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(period.sheetRange)}?key=${API_KEY}`;
                const response = await fetch(url);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`[${period.sheetName}] HTTP error: ${errorData.message || response.status}`);
                }

                const data = await response.json();
                if (!data.values || data.values.length === 0) continue;

                const [headerRow, ...dataRows] = data.values;
                // Col 0, 1, 2 are Name, Name, Designation. Col 3+ are dates/statuses.
                const dateHeaders = headerRow.slice(3);
                
                // Add new dates to the master list
                if (uniqueDates.length === 0) {
                     uniqueDates.push(...headerRow.slice(0, 3), ...dateHeaders);
                } else {
                    // Append new date headers if they don't exist (handle case where P1 and P2 have slightly different date columns)
                    dateHeaders.forEach(date => {
                        if (!uniqueDates.includes(date)) {
                            uniqueDates.push(date);
                        }
                    });
                }
                
                // Process sellers
                dataRows.forEach(row => {
                    // Assume name is in column A and B (index 0 and 1) and designation in C (index 2)
                    const fullName = `${row[0] || ''} ${row[1] || ''}`.trim();
                    const designation = (row[2] || '').trim().toUpperCase();

                    if (!fullName) return;

                    if (!sellerMap.has(fullName)) {
                        // Initialize seller 
                        sellerMap.set(fullName, { 
                            name: fullName, 
                            designation: designation, 
                            attendance: {} 
                        });
                    }

                    // Map attendance status for this period
                    dateHeaders.forEach((date, index) => {
                         const status = (row[index + 3] || '').trim();
                         // Only store non-empty statuses, giving preference to data already stored (in case of overlap, but typically sheets are unique)
                         if (status) {
                             sellerMap.get(fullName).attendance[date] = status;
                         }
                    });
                });
            }
            
            // Finalize the matrix structure
            let combinedMatrix = [];
            // Header: [FName, LName, Designation, Date1, Date2, ...]
            combinedMatrix.push(uniqueDates); 
            
            sellerMap.forEach(seller => {
                let row = [
                    seller.name.split(' ')[0] || '', 
                    seller.name.split(' ')[1] || '', 
                    seller.designation
                ];
                
                // Append status for each date column using the full list of unique dates
                uniqueDates.slice(3).forEach(date => {
                    // Use status or an empty string if status is not available for that date
                    const status = seller.attendance[date] || ''; 
                    row.push(status);
                });
                combinedMatrix.push(row);
            });
            
            if (combinedMatrix.length <= 1) { // Only header row exists
                throw new Error("No seller data found after combining periods.");
            }

            attendanceDataCache[monthYearKey] = combinedMatrix;
            return combinedMatrix;
        }


        /**
         * Fetches attendance data for the specified date and displays the result in a modal.
         * @param {string} dateString - The date clicked (e.g., "9/1/2025").
         */
        async function fetchAndShowDailyAttendance(dateString) {
            const modalBody = document.getElementById('attendanceDetailsBody');
            const modalTitle = document.getElementById('attendanceModalLabel');
            modalTitle.textContent = `Daily Status for ${dateString}`;
            modalBody.innerHTML = '<div class="text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin gold-accent me-2"></i> Fetching attendance details...</div>';
            
            const modal = new bootstrap.Modal(document.getElementById('attendanceModal'));
            modal.show();
            
            const dateConfig = getDatePeriodConfig(dateString);
            if (!dateConfig) {
                 modalBody.innerHTML = `<div class="alert alert-warning">⚠️ Configuration Error: No sheet defined for **${dateString}**. Check **ATTENDANCE_CONFIG**.</div>`;
                 return;
            }
            
            const rangeToFetch = dateConfig.sheetRange;

            try {
                // Fetch the specific single sheet that contains the date
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(rangeToFetch)}?key=${API_KEY}`;
                const response = await fetch(url);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();

                if (!data.values || data.values.length < 2) {
                    modalBody.innerHTML = `<div class="alert alert-warning">⚠️ No seller data found in sheet **${dateConfig.sheetName}** for the range **${dateConfig.sheetRange}**.</div>`;
                    return;
                }

                const [headerRow, ...sellerRows] = data.values;
                
                // Find the column index that matches the clicked date (Daily View)
                const dateHeaderIndex = headerRow.findIndex((cell, index) => {
                    if (index < 3) return false; // Skip first three columns (Name/Designation)
                    
                    // Normalize clicked date (9/4/2025)
                    const normalizedClickedDate = new Date(dateString).toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: 'numeric' });
                    
                    // Normalize spreadsheet cell date 
                    const cellDate = new Date(cell);
                    let normalizedCell = '';
                    if (!isNaN(cellDate)) {
                        normalizedCell = cellDate.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: 'numeric' });
                    }
                    
                    // Check for match
                    return normalizedClickedDate === normalizedCell;
                });

                if (dateHeaderIndex === -1) {
                    modalBody.innerHTML = `<div class="alert alert-warning">⚠️ Date column not found for **${dateString}** in sheet **${dateConfig.sheetName}**. Please check the spreadsheet header dates.</div>`;
                    return;
                }
                
                // --- Process Daily Status ---
                let presentCount = 0;
                let absentCount = 0;
                let otherCount = 0;
                let dailyStatusList = []; // List holds ALL statuses for summary calculation

                sellerRows.forEach(row => {
                    const fullName = `${row[0] || ''} ${row[1] || ''}`.trim();
                    const designation = (row[2] || '').trim();
                    if (!fullName) return;

                    const rawStatus = (row[dateHeaderIndex] || '').trim().toUpperCase();
                    let status = rawStatus === '' ? 'ABSENT' : rawStatus;
                    
                    let statusAbbrev = status.substring(0, 1) || 'A';
                    let statusColorClass = 'text-info';
                    let statusBorderClass = 'status-O-border';

                    if (status.includes('PRESENT') || status === 'P') {
                        statusAbbrev = 'P';
                        presentCount++;
                        statusColorClass = 'text-success';
                        statusBorderClass = 'status-P-border';
                    } else if (status.includes('ABSENT') || status === 'A' || status === '') {
                        statusAbbrev = 'A';
                        absentCount++;
                        statusColorClass = 'text-danger';
                        statusBorderClass = 'status-A-border';
                        status = 'ABSENT'; // standardize display
                    } else if (status.includes('LATE') || status === 'L' || status.includes('DAY OFF') || status === 'D') {
                        // Count Late/Day Off/Other statuses here
                        otherCount++;
                        statusColorClass = 'text-primary';
                        statusBorderClass = 'status-L-border';
                    } else {
                        otherCount++;
                        statusColorClass = 'text-warning';
                        statusBorderClass = 'status-O-border';
                    }

                    dailyStatusList.push({ name: fullName, designation, status, statusColorClass, statusBorderClass });
                });

                // --- NEW LOGIC: FILTER FOR ONLY PRESENT SELLERS ---
                const presentSellersOnlyList = dailyStatusList.filter(item => 
                    item.status.includes('PRESENT') || item.status === 'P'
                );

                // Sort the filtered list by name
                presentSellersOnlyList.sort((a, b) => a.name.localeCompare(b.name));
                
                
                // --- Start Rendering HTML ---

                // 1. Render Summary (Modified to only show Present)
                let htmlContent = `
                    <h4 class="gold-accent mb-3">Daily Summary: ${dateString}</h4>
                    <div class="text-center fw-bold mb-4">
                        <span class="text-success fs-5">Present: ${presentCount}</span>
                    </div>
                    <hr class="border-secondary">
                `;

                // 2. Render ONLY Present Sellers List
                if (presentSellersOnlyList.length > 0) {
                    htmlContent += '<h5 class="gold-accent mt-4 mb-3">Personnel Marked as PRESENT:</h5>';
                    htmlContent += '<ul class="daily-status-list">';
                    
                    presentSellersOnlyList.forEach(item => { 
                        // Status is guaranteed to be Present for this list
                        htmlContent += `
                            <li class="daily-status-item ${item.statusBorderClass}">
                                <div>
                                    <span class="fw-bold">${item.name}</span>
                                    <span class="text-white-50 ms-2 text-sm">(${item.designation})</span>
                                </div>
                                <span class="${item.statusColorClass} fw-bold">${item.status}</span>
                            </li>
                        `;
                    });
                    
                    htmlContent += '</ul>';
                } else {
                    htmlContent += '<div class="alert alert-info">No personnel were marked as PRESENT for this day.</div>';
                }
                
                modalBody.innerHTML = htmlContent;

            } catch (error) {
                modalBody.innerHTML = `<div class="alert alert-danger">❌ Failed to load attendance. Error: ${error.message}</div>`;
                console.error(`Error loading attendance for ${dateString}:`, error);
            }
        }

        /**
         * Calculates and displays the total deployment for the entire month (TL and Sellers).
         * This fetches and combines data from all configured sheets for the current month.
         */
        async function showMonthlyDeploymentTotals() {
            const outputElement = document.getElementById('mandays-report-output');
            outputElement.innerHTML = '<div class="text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin gold-accent me-2"></i> Calculating total monthly deployment...</div>';
            
            // FIX: Use currentCalendarDate to derive the monthYearKey dynamically
            const month = currentCalendarDate.getMonth() + 1;
            const year = currentCalendarDate.getFullYear();
            const monthYearKey = `${month}/${year}`; 
            const monthName = currentCalendarDate.toLocaleString('default', { month: 'long', year: 'numeric' });

            try {
                const combinedMatrix = await fetchAttendanceDataForPeriod(monthYearKey);
                
                // combinedMatrix[0] is header row (FName, LName, Designation, Date1, Date2...)
                const [headerRow, ...sellerRows] = combinedMatrix;
                
                let totalTLAttendance = 0;
                let totalSellerAttendance = 0;
                
                // Assuming Designation is at index 2, and Dates start at index 3
                const dateColumnsStart = 3; 

                sellerRows.forEach(row => {
                    const designation = (row[2] || '').trim().toUpperCase();
                    const isTL = designation.includes('TEAM LEADER') || designation.includes('TL');
                    const isSeller = designation.includes('SELLER');
                    
                    // Iterate through all date status cells
                    for (let i = dateColumnsStart; i < row.length; i++) {
                        const status = (row[i] || '').trim().toUpperCase();
                        const isPresent = status.includes('PRESENT') || status === 'P';
                        
                        if (isPresent) {
                            if (isTL) {
                                totalTLAttendance++;
                            } else if (isSeller) {
                                totalSellerAttendance++;
                            }
                        }
                    }
                });

                // NOTE: Targets are hardcoded based on previous user input (Sept 2025 structure)
                const tlTarget = 23; 
                const sellerTarget = 176; 

                outputElement.innerHTML = `
                    <div class="p-4">
                        <h4 class="gold-accent mb-3">Total Deployment (Combined ${monthName})</h4>
                        <hr class="border-secondary">
                        <div class="row text-center">
                            <div class="col-md-6 mb-3">
                                <h5 class="text-white">Team Leader (TL)</h5>
                                <p class="mb-1">Present Mandays: <span class="fw-bold text-success">${totalTLAttendance}</span></p>
                                <p class="mb-1 text-white-50">Target Mandays: ${tlTarget}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h5 class="text-white">Sellers</h5>
                                <p class="mb-1">Present Mandays: <span class="fw-bold text-success">${totalSellerAttendance}</span></p>
                                <p class="mb-1 text-white-50">Target Mandays: ${sellerTarget}</p>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                outputElement.innerHTML = `<div class="alert alert-danger">❌ Failed to calculate monthly totals for ${monthYearKey}. Error: ${error.message}</div>`;
                console.error("Error calculating monthly deployment totals:", error);
            }
        }
        
        /**
         * Calculates and displays the total attendance days per unique seller for the entire month,
         * with a breakdown for P1 (1-15) and P2 (16-30) payroll periods.
         * This fetches and combines data from all configured sheets for the current month.
         */
        async function showAttendancePerSellerReport() {
            const outputElement = document.getElementById('mandays-report-output');
            outputElement.innerHTML = '<div class="text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin gold-accent me-2"></i> Calculating attendance per seller...</div>';
            
            // FIX: Use currentCalendarDate to derive the monthYearKey dynamically
            const month = currentCalendarDate.getMonth() + 1;
            const year = currentCalendarDate.getFullYear();
            const monthYearKey = `${month}/${year}`;

            try {
                const combinedMatrix = await fetchAttendanceDataForPeriod(monthYearKey);
                const [headerRow, ...sellerRows] = combinedMatrix;
                
                const periodsConfig = ATTENDANCE_CONFIG[monthYearKey];
                
                let sellerTotalsMap = new Map();
                const dateColumnsStart = 3;
                const dateHeaders = headerRow.slice(dateColumnsStart); // Date strings: '9/1/2025', '9/2/2025', ...

                sellerRows.forEach(row => {
                    const fullName = `${row[0] || ''} ${row[1] || ''}`.trim();
                    if (!fullName) return;

                    let totalPresentDaysP1 = 0;
                    let totalPresentDaysP2 = 0;
                    
                    // Iterate through all status cells (index 3 onwards, relative to full row)
                    for (let i = dateColumnsStart; i < row.length; i++) {
                        const status = (row[i] || '').trim().toUpperCase();
                        const isPresent = status.includes('PRESENT') || status === 'P';
                        
                        if (isPresent) {
                            // Determine the day of the month for payroll split
                            const dateString = dateHeaders[i - dateColumnsStart];
                            const dateParts = dateString.split('/');
                            const dayOfMonth = parseInt(dateParts[1], 10); // Assumes M/D/YYYY format 
                            
                            // Check against defined periods in the config for this month
                            if (periodsConfig.length >= 1 && dayOfMonth >= periodsConfig[0].startDay && dayOfMonth <= periodsConfig[0].endDay) {
                                totalPresentDaysP1++;
                            } 
                            // Only check for P2 if a second period is defined
                            else if (periodsConfig.length >= 2 && dayOfMonth >= periodsConfig[1].startDay && dayOfMonth <= periodsConfig[1].endDay) {
                                totalPresentDaysP2++;
                            }
                            // NOTE: For months with only one period (like Oct 1-15 provided), P2 will remain 0.
                        }
                    }
                    
                    sellerTotalsMap.set(fullName, {
                        p1: totalPresentDaysP1,
                        p2: totalPresentDaysP2,
                        total: totalPresentDaysP1 + totalPresentDaysP2
                    });
                });

                // Convert map to array and sort by overall total attendance (highest first)
                const sortedSellers = Array.from(sellerTotalsMap.entries())
                    .map(([name, data]) => ({ name, ...data }))
                    .sort((a, b) => b.total - a.total);

                if (sortedSellers.length === 0) {
                    outputElement.innerHTML = `<div class="alert alert-warning">No seller attendance data found for the month.</div>`;
                    return;
                }

                const period1Label = periodsConfig[0]?.sheetName.split('!')[0] || 'Period 1';
                const period2Label = periodsConfig[1]?.sheetName.split('!')[0] || 'Period 2 (N/A)';

                let listHtml = `<h4 class="gold-accent mb-3">Seller Attendance Totals (Mandays Breakdown for ${monthYearKey})</h4><ul class="list-group">`;
                
                sortedSellers.forEach(seller => {
                    listHtml += `
                        <li class="list-group-item d-flex justify-content-between align-items-center futuristic-card border-left status-P-border p-3 mb-1">
                            <div>
                                <span class="fw-bold text-white">${seller.name}</span>
                                <div class="payroll-breakdown mt-1">
                                    <span class="payroll-p1">${period1Label}: ${seller.p1} days</span>
                                    <span class="payroll-p2">${period2Label}: ${seller.p2} days</span>
                                </div>
                            </div>
                            <span class="badge bg-success rounded-pill p-2 fs-6">${seller.total} TOTAL</span>
                        </li>
                    `;
                });
                
                listHtml += '</ul>';
                outputElement.innerHTML = listHtml;


            } catch (error) {
                outputElement.innerHTML = `<div class="alert alert-danger">❌ Failed to calculate seller attendance for ${monthYearKey}. Error: ${error.message}</div>`;
                console.error("Error calculating seller attendance:", error);
            }
        }

        // --- NEW CALENDAR LOGIC ---

        /**
         * Renders a basic calendar structure for the current month and attaches click handlers.
         * @param {string} targetId - The ID of the container to render the calendar into.
         * @param {Date} date - The date object used to determine the current month/year.
         */
        function renderAttendanceCalendar(targetId, date) {
            const container = document.getElementById(targetId);
            const year = date.getFullYear();
            const month = date.getMonth();
            
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0 = Sunday, 1 = Monday...
            
            const monthName = date.toLocaleString('default', { month: 'long' });
            
            const monthYearKey = `${month + 1}/${year}`;
            const isConfigured = !!ATTENDANCE_CONFIG[monthYearKey]; 

            if (!isConfigured) {
                container.innerHTML = `<div class="alert alert-danger">❌ Error: No sheet configuration found for ${monthName} ${year}. Please check **ATTENDANCE_CONFIG**.</div>`;
                return;
            }

            let calendarHtml = `
                <div class="futuristic-card p-0">
                    <div class="calendar-nav text-center mb-2">
                        <button onclick="changeCalendarMonth(-1)" title="Previous Month">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span>${monthName} ${year}</span>
                        <button onclick="changeCalendarMonth(1)" title="Next Month">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-grid">
                        <div class="day-name">Sun</div>
                        <div class="day-name">Mon</div>
                        <div class="day-name">Tue</div>
                        <div class="day-name">Wed</div>
                        <div class="day-name">Thu</div>
                        <div class="day-name">Fri</div>
                        <div class="day-name">Sat</div>
            `;

            // Add leading blank days
            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarHtml += `<div class="day-cell inactive"></div>`;
            }

            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                // Formatting date string as M/D/YYYY (e.g., 9/1/2025)
                const dateString = `${month + 1}/${day}/${year}`;
                
                // Attach the click handler to call fetchAndShowDailyAttendance
                calendarHtml += `<div class="day-cell" data-date="${dateString}" onclick="fetchAndShowDailyAttendance('${dateString}')">${day}</div>`;
            }

            calendarHtml += `</div></div>`;
            container.innerHTML = calendarHtml;
        }

        /**
         * Navigates the calendar view by changing the currentCalendarDate.
         * @param {number} offset - -1 for previous month, 1 for next month.
         */
        function changeCalendarMonth(offset) {
            // Clear cache if we are changing months, as the underlying sheet data will change
            attendanceDataCache = {}; 
            
            // Set the new date based on the current date + offset
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + offset);
            
            // Re-render the calendar for the new month/year
            renderAttendanceCalendar('mandays-report-output', currentCalendarDate);
        }
        
        // --- END CALENDAR LOGIC ---

        /**
         * Handles clicks for the Mandays sub-reports, rendering data or calling prompt.
         * @param {string} reportType - The type of report to show ('attendance_per_seller', 'daily_calendar', 'monthly_deployment').
         */
        async function showMandaysReport(reportType) {
            const outputElement = document.getElementById('mandays-report-output');
            outputElement.innerHTML = '<div class="text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin gold-accent me-2"></i> Loading report...</div>';

            switch (reportType) {
                case 'attendance_per_seller':
                    await showAttendancePerSellerReport();
                    break;

                case 'daily_calendar':
                    // Render the interactive calendar directly
                    renderAttendanceCalendar('mandays-report-output', currentCalendarDate); 
                    break;
                    
                case 'monthly_deployment':
                    await showMonthlyDeploymentTotals();
                    break;

                default:
                    outputElement.innerHTML = `<div class="alert alert-warning">Invalid report selected.</div>`;
            }
        }
        
        /**
         * Handles clicks for the Postpaid sub-reports.
         * @param {string} reportType - The type of report to show ('total_submitted', 'total_approved', etc.).
         */
        async function showPostpaidReport(reportType) {
            const outputElement = document.getElementById('postpaid-report-output');
            outputElement.innerHTML = '<div class="text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin gold-accent me-2"></i> Loading report...</div>';

            const config = POSTPAID_CONFIG[reportType];
            if (!config) {
                outputElement.innerHTML = `<div class="alert alert-warning">Invalid Postpaid report selected.</div>`;
                return;
            }
            
            // Generate a simple key for the report title
            const reportTitle = reportType.replace(/_/g, ' ').toUpperCase();
            
            // Call the general fetcher function
            await fetchAndRender(
                SPREADSHEET_ID,
                config.range,
                'postpaid-report-output', // Target the dedicated output div
                config.headers
            );

            // After rendering the table, update the title/description area
            outputElement.insertAdjacentHTML('afterbegin', `<h4 class="gold-accent mb-3">${reportTitle}</h4><hr class="border-secondary">`);
        }
        
        
        /**
         * Fetches data from Google Sheets and renders it as an HTML table.
         */
        async function fetchAndRender(spreadsheetId, range, targetId, customHeaders = null) {
            const targetElement = document.getElementById(targetId);
            // Show loading state, but preserve the original "Select a report" text temporarily
            const originalContent = targetElement.innerHTML;
            targetElement.innerHTML = '<div class="text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin gold-accent me-2"></i> Loading data from Google Sheets...</div>';

            // Use the standard Sheets API for raw table data
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
            

            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.json();

                if (!data.values || data.values.length === 0) {
                    targetElement.innerHTML = '<div class="alert alert-warning">⚠️ No data found for the specified range.</div>';
                    return;
                }

                const rows = data.values;
                // Clear the target element completely before inserting the table (to avoid stacking)
                targetElement.innerHTML = ''; 
                let html = '<div class="table-responsive"><table class="table table-dark table-bordered"><thead><tr>';
                
                // Determine headers and data rows
                let headers = [];
                let dataRows = [];

                if (customHeaders && customHeaders.length > 0) {
                    // Use custom headers and assume the single fetched row contains the data
                    headers = customHeaders;
                    dataRows = rows;
                } else {
                    // Use the first fetched row as header and the rest as data
                    headers = rows[0];
                    dataRows = rows.slice(1);
                }
                
                // Render headers
                headers.forEach(header => html += `<th scope="col">${header}</th>`);
                html += '</tr></thead><tbody>';

                // Render data rows
                dataRows.forEach(row => {
                    html += '<tr>';
                    // Ensure row has enough cells to match header length for consistent columns
                    const headerCount = headers.length; // Use the derived headers length
                    for (let i = 0; i < headerCount; i++) {
                        const cell = row[i] !== undefined ? row[i] : '';
                        html += `<td>${cell}</td>`;
                    }
                    html += '</tr>';
                });

                html += '</tbody></table></div>';
                targetElement.innerHTML = html;

            } catch (error) {
                targetElement.innerHTML = `<div class="alert alert-danger">❌ Failed to load data. Error: ${error.message}</div>`;
                console.error(`Error loading ${range} from ${spreadsheetId}:`, error);
            }
        }
        
        /**
         * Fetches data for charting and renders a Chart.js visualization.
         */
        async function fetchAndRenderChart(spreadsheetId, range, canvasId, config) {
            const chartElement = document.getElementById(canvasId);
            const parentElement = chartElement.closest('.collapse');
            
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
            
            // Clear previous chart and show loading state
            if (chartInstances[canvasId]) {
                chartInstances[canvasId].destroy();
                delete chartInstances[canvasId];
            }
            // Add a temporary loading indicator before fetching
            parentElement.innerHTML = '<div class="chart-container text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin gold-accent me-2"></i> Loading chart data...</div>';

            try {
                let labels = [];
                let values = [];

                if (config.processingMode === 'daily_total') {
                    // --- MODE 1: DAILY TOTAL (Column Sums) ---
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (!data.values || data.values.length < 2) throw new Error("Insufficient data for single period chart.");

                    labels = data.values[0].slice(3).filter(label => label.trim() !== '');
                    const numDays = labels.length;
                    const dailyTotals = new Array(numDays).fill(0);
                    
                    for (let j = 1; j < data.values.length; j++) {
                        for (let i = 0; i < numDays; i++) {
                            const saleValue = parseFloat(data.values[j][i + 3]) || 0;
                            dailyTotals[i] += saleValue;
                        }
                    }
                    values = dailyTotals;

                } else if (config.processingMode === 'seller_total') {
                    // --- MODE 2: SELLER TOTAL (Row Sums - Simple) ---
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (!data.values || data.values.length < 2) throw new Error("Insufficient data for single period chart.");
                    
                    let sellerTotalsMap = {};
                    
                    for (let j = 1; j < data.values.length; j++) {
                        const row = data.values[j];
                        const fullName = `${row[0] || ''} ${row[1] || ''}`.trim();
                        if (!fullName) continue;

                        let totalCount = 0;
                        for (let i = 3; i < row.length; i++) {
                            const saleValue = parseFloat(row[i]) || 0;
                            totalCount += saleValue;
                        }
                        sellerTotalsMap[fullName] = (sellerTotalsMap[fullName] || 0) + totalCount;
                    }
                    labels = Object.keys(sellerTotalsMap);
                    values = Object.values(sellerTotalsMap);

                } else {
                    // --- Default Simple Column Pull (Labels Col 1, Values Col 2) ---
                     const response = await fetch(url);
                     const data = await response.json();
                     labels = data.values.slice(1).map(row => row[0] || 'N/A');
                     values = data.values.slice(1).map(row => parseFloat(row[1]) || 0);
                }
                
                if (values.length === 0 || values.every(val => val === 0)) {
                    parentElement.innerHTML = '<div class="chart-container alert alert-warning">⚠️ Chart data calculation failed or all values are zero.</div>';
                    return;
                }

                // Restore canvas element for Chart.js
                parentElement.innerHTML = `<div class="chart-container"><canvas id="${canvasId}"></canvas></div>`;
                const ctx = document.getElementById(canvasId).getContext('2d');
                
                chartInstances[canvasId] = new Chart(ctx, {
                    type: config.chartType, // 'bar' or 'line'
                    data: {
                        labels: labels, 
                        datasets: [{
                            label: config.dataLabel,
                            data: values, 
                            backgroundColor: config.chartType === 'bar' ? 'rgba(255, 215, 0, 0.7)' : 'rgba(79, 70, 229, 0.7)', 
                            borderColor: config.chartType === 'bar' ? '#FFD700' : '#4F46E5',
                            borderWidth: 2,
                            // Use fill for line charts, borderRadius for bar charts
                            fill: config.chartType === 'line' ? true : false,
                            tension: 0.4,
                            borderRadius: config.chartType === 'bar' ? 5 : 0,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                labels: { 
                                    color: '#FFD700', 
                                    font: { family: 'Orbitron' } 
                                } 
                            },
                            title: {
                                display: true,
                                text: config.chartTitle,
                                color: '#EC4899',
                                font: { family: 'Orbitron', size: 18 }
                            },
                        },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                ticks: { color: 'white', font: { family: 'Orbitron' } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' } 
                            },
                            x: { 
                                ticks: { color: 'white', font: { family: 'Orbitron' } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' } 
                            }
                        }
                    }
                });

            } catch (error) {
                parentElement.innerHTML = `<div class="chart-container alert alert-danger">❌ Failed to render chart. Error: ${error.message}</div>`;
                console.error(`Error loading chart data from range:`, error);
            }
        }
        

        // --- View Switching Logic (for single-page navigation) ---
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Map navigation ID to the correct element ID
            let targetId;
            if (viewId.startsWith('project-')) {
                 targetId = `${viewId}-view`;
            } else if (viewId === 'home') {
                targetId = 'home-view';
            } else {
                targetId = `${viewId}-view`; // 'about', 'contact'
            }


            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.style.display = 'block';
            }
        }

        // --- Bootstrap Collapse Event Listeners for Dynamic Data Loading ---
        // Listener function helper
        function setupCollapseListener(contentId, range, config = {}) {
            const element = document.getElementById(contentId);
            if (!element) {
                return; // Safely exit if the element is null
            }

            element.addEventListener('show.bs.collapse', function () {
                // Since Postpaid logic is moved to showPostpaidReport, 
                // we only need to handle the non-Postpaid items here.
                if (contentId.includes('postpaid')) return;

                // Check if content already exists to prevent repeated API calls/rendering
                if (this.querySelector('.table-responsive') === null && this.querySelector('.chart-container') === null) {
                    if (config.type === 'chart') {
                        // For chart rendering, call the specific chart function
                        fetchAndRenderChart(
                            SPREADSHEET_ID,
                            range,
                            config.canvasId,
                            config
                        );
                    } else {
                        // For table rendering, call the standard fetch function
                        fetchAndRender(
                            SPREADSHEET_ID,
                            range,
                            contentId,
                            config.customHeaders
                        );
                    }
                }
            });
            // Cleanup on hide
            element.addEventListener('hide.bs.collapse', function () {
                if (config.type === 'chart' && chartInstances[config.canvasId]) {
                    chartInstances[config.canvasId].destroy();
                    delete chartInstances[config.canvasId];
                }
            });
        }

        function initializeListeners() {
            // NOTE: Mandays listeners are handled by the showMandaysReport function now.
            // NOTE: Postpaid listeners are handled by showPostpaidReport and no longer need individual setupCollapseListener calls.

            // 3. WOWFI PRO PREPAID REPORTS
            setupCollapseListener('wowfi-sold-content', 'summaryReports!AE24:AG24', {customHeaders: ['Total', 'Target','Achievement']}); 

            // 4. SIM SOLD REPORTS
            setupCollapseListener('simsold-sold-content', 'summaryReports!AE25:AG25', {customHeaders: ['Total', 'Target', 'Achievement']}); 
        }


        // Initialize all listeners after the entire HTML structure is loaded.
        document.addEventListener('DOMContentLoaded', () => {
            initializeListeners();
            switchView('home'); // Load the new grid view first
        });
    </script>
</body>
</html>
